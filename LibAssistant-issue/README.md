# Issue-Service (микросервис выдачи/возврата)

Короткая инструкция по запуску и тестированию микросервиса выдачи/возврата книг.

Требования
- Python 3.8+
- Установить зависимости: pip install -r requirements.txt

Запуск сервера
1. Перейдите в папку issue_microservice.
2. Запустите python server.py  при первом запуске сгенерируется Python код из proto и будет создана база issue_service.db.

Примеры использования
- В другом терминале запустите python client.py для простых сценариев: проверка наличия, выдача книги, просмотр должников.

Особенности реализации
- Протокол: gRPC (proto в protos/issue.proto).
- Транзакции: операции выдачи/возврата выполняются в транзакции SQLite через SQLAlchemy.
- Кэш: файл-кэш cache/debtors_cache.json хранит результаты ViewDebtors с TTL (по умолчанию 60 секунд).
- Авто-расчёт просрочки: при операциях и при запросах долги пересчитываются и сохраняются в записях issues.

Файлы
- server.py  gRPC сервер и обработчики (основная логика).
- db.py  модели SQLAlchemy и функции инициализации/расчёта просрочек.
- cache.py  простой JSON кэш для списка должников.
- protos/issue.proto  описание API gRPC.
- client.py  пример клиента для быстрого тестирования.
